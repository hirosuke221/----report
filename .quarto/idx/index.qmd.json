{"title":"住宅選定レポート：高砂市・加古川市・明石市","markdown":{"yaml":{"title":"住宅選定レポート：高砂市・加古川市・明石市","subtitle":"合理的な住宅選択のための比較分析","author":"","date":"today","date-format":"YYYY年MM月DD日"},"headingText":"エグゼクティブサマリー","headingAttr":{"id":"sec-summary","classes":[],"keyvalue":[]},"containsRefs":false,"markdown":"\n\n```{python}\n#| label: setup\n#| include: false\n\nimport pandas as pd\nimport plotly.graph_objects as go\nimport plotly.express as px\nfrom pathlib import Path\nfrom IPython.display import display\n\nDATA_DIR = Path(\"data\")\n\nCITY_COLORS = {\n    \"高砂市\":  \"#2196F3\",\n    \"加古川市\": \"#4CAF50\",\n    \"明石市\":  \"#FF9800\",\n}\n```\n\n\n本レポートは、兵庫県内の3市（高砂市・加古川市・明石市）における中古住宅購入の意思決定を支援するため、複数の評価軸にわたる比較分析を行ったものです。\n\n::: {.callout-note}\n**通勤先**: 神戸製鋼所 高砂製作所（高砂市荒井町新浜2-3-1）\n**取得形態**: 中古住宅購入\n**重視事項**: 治安・安全性（20%）、教育環境（20%）、子育て支援（15%）\n:::\n\n---\n\n## 評価方法・前提条件 {#sec-method}\n\n### 評価フレームワーク\n\n以下の6軸で各市を評価し、重み付きスコア（各軸5点満点）で総合評価を算出する。30代前半・1〜2年以内に出産予定という家族計画を踏まえ、子育て支援・医療環境を新たに追加した。\n\n```{python}\n#| label: weights-table\n\nweights = {\n    \"評価軸\": [\"治安・安全性\", \"教育環境\", \"交通アクセス\", \"子育て支援・行政\", \"医療環境\", \"住宅価格\"],\n    \"重み\": [\"20%\", \"20%\", \"10%\", \"15%\", \"10%\", \"25%\"],\n    \"選定理由\": [\n        \"子どもの安全な育ちに直結\",\n        \"長期的な教育選択肢（保育〜高校）\",\n        \"高砂製作所への通勤効率\",\n        \"保育料・医療費助成など出産後の家計負担（新規）\",\n        \"産婦人科・NICU・小児救急など出産育児の医療アクセス（新規）\",\n        \"中古住宅購入コスト\",\n    ]\n}\npd.DataFrame(weights).style.hide(axis=\"index\")\n```\n\n---\n\n## 各市の概要 {#sec-overview}\n\n| 項目 | 高砂市 | 加古川市 | 明石市 |\n|------|--------|----------|--------|\n| 人口（2024年） | 約8.3万人 | 約25.7万人 | 約29.7万人 |\n| 面積 | 約34 km² | 約138 km² | 約49 km² |\n| 特徴 | 工業都市・職場最寄り | 播磨地域の中心都市 | 子育て支援・神戸隣接 |\n\n---\n\n## 評価軸別分析 {#sec-analysis}\n\n### 交通アクセス {#sec-access}\n\n通勤先（高砂製作所）までのアクセスを評価する。\n\n```{python}\n#| label: commute-table\n\ncommute = {\n    \"市\": [\"高砂市\", \"加古川市\", \"明石市\"],\n    \"車（目安）\": [\"5〜15分\", \"20〜30分\", \"30〜45分\"],\n    \"電車\": [\"山陽荒井駅 / JR宝殿駅\", \"JR加古川駅経由・乗換1回\", \"JR/山陽・乗換1〜2回\"],\n    \"スコア（5点満点）\": [5, 3, 2],\n}\npd.DataFrame(commute).style.hide(axis=\"index\")\n```\n\n*出典: Googleマップ・各社乗換案内（手動調査）*\n\n### 治安・安全性 {#sec-safety}\n\n犯罪統計と自然災害リスクの2軸で評価する。\n\n```{python}\n#| label: safety-table\n\ncrime_file = DATA_DIR / \"crime_stats.csv\"\nif crime_file.exists():\n    df_crime = pd.read_csv(crime_file, encoding=\"utf-8-sig\")\n    display(df_crime[[\"市\", \"年\", \"認知件数（件）\", \"人口1万人あたり認知件数\"]].style.hide(axis=\"index\"))\nelse:\n    print(\"⚠ データ未取得: data_collect.py を実行してください\")\n```\n\n```{python}\n#| label: safety-chart\n\nif crime_file.exists():\n    fig = px.bar(\n        df_crime,\n        x=\"市\",\n        y=\"人口1万人あたり認知件数\",\n        color=\"市\",\n        color_discrete_map={\"高砂市\": \"#1f77b4\", \"加古川市\": \"#ff7f0e\", \"明石市\": \"#2ca02c\"},\n        title=\"人口1万人あたり刑法犯認知件数（令和6年確定値）\",\n        labels={\"人口1万人あたり認知件数\": \"認知件数（件/万人）\"},\n        text_auto=True,\n    )\n    fig.update_layout(showlegend=False, yaxis_title=\"件/万人\")\n    fig.show()\n```\n\n*出典: 兵庫県警察「市区町別刑法犯認知状況（令和6年確定値）」<https://www.police.pref.hyogo.lg.jp/seikatu/gaitou/statis/data/R06.pdf>*\n\n**自然災害リスク（国土交通省ハザードマップより）**\n\n| リスク種別 | 高砂市 | 加古川市 | 明石市 |\n|-----------|--------|----------|--------|\n| 津波・高潮 | 高（沿岸部） | 中（一部沿岸） | 中（一部沿岸） |\n| 洪水（河川） | 高（加古川河口） | 高（加古川沿い） | 低〜中 |\n| 土砂災害 | 低 | 中（北部） | 低 |\n\n*出典: 国土交通省 ハザードマップポータルサイト <https://disaportal.gsi.go.jp/>（各市ハザードマップより整理）*\n\n::: {.callout-warning}\n高砂市・加古川市は**加古川下流域**に位置し、洪水リスクが高い地区があります。\n購入前に物件ごとのハザードマップ確認を推奨します。\n:::\n\n### 保育園・就学前教育 {#sec-nursery}\n\n認可保育所・認定こども園の量と質（保育料・待機児童・病児保育等）を評価する。\n\n```{python}\n#| label: nursery-bar\n\nnursery_file = DATA_DIR / \"nursery.csv\"\nif nursery_file.exists():\n    df_nur = pd.read_csv(nursery_file, encoding=\"utf-8-sig\")\n\n    fig = go.Figure()\n    fig.add_trace(go.Bar(\n        name=\"認可保育所\",\n        x=df_nur[\"市\"],\n        y=df_nur[\"認可保育所数\"],\n        marker_color=[CITY_COLORS[c] for c in df_nur[\"市\"]],\n        opacity=0.9,\n    ))\n    fig.add_trace(go.Bar(\n        name=\"認定こども園\",\n        x=df_nur[\"市\"],\n        y=df_nur[\"認定こども園数\"],\n        marker_color=[CITY_COLORS[c] for c in df_nur[\"市\"]],\n        opacity=0.5,\n    ))\n    fig.update_layout(\n        barmode=\"stack\",\n        title=\"就学前教育施設数（認可保育所＋認定こども園）\",\n        yaxis_title=\"施設数（園）\",\n        xaxis_title=\"\",\n        legend=dict(orientation=\"v\", x=0.98, y=0.98, xanchor=\"right\", yanchor=\"top\"),\n    )\n    fig.show()\nelse:\n    print(\"⚠ データ未取得: data_collect.py を実行してください\")\n```\n\n```{python}\n#| label: nursery-table\n\nif nursery_file.exists():\n    display_cols = [\"市\", \"待機児童数（人）\", \"保育料月額目安（万円）\", \"第2子以降無償化\", \"病児保育対応施設数\"]\n    display(df_nur[display_cols].style.hide(axis=\"index\"))\n```\n\n*出典: 各市公式ウェブサイト / こども家庭庁「保育所等関連状況取りまとめ」（2023年4月時点）*\n\n::: {.callout-tip}\n**明石市の特記事項**: 全国初の「第2子以降の保育料を所得制限なく全額無償化」を独自施策として実施。保育料の実質負担が大幅に軽減され、近年の人口増加を支える要因のひとつ。\n:::\n\n### 高校進学環境 {#sec-highschool}\n\n市内の公立高校の偏差値分布から、進学環境の質と選択肢の広さを評価する。\n\n```{python}\n#| label: highschool-dot\n\nhs_file = DATA_DIR / \"highschool.csv\"\nif hs_file.exists():\n    df_hs = pd.read_csv(hs_file, encoding=\"utf-8-sig\")\n\n    fig = px.strip(\n        df_hs,\n        x=\"偏差値\",\n        y=\"市\",\n        color=\"市\",\n        hover_data=[\"高校名\", \"偏差値\"],\n        title=\"市内公立高校 偏差値分布\",\n        color_discrete_map=CITY_COLORS,\n        stripmode=\"overlay\",\n    )\n    fig.update_traces(marker_size=14, marker_opacity=0.85)\n    fig.update_layout(\n        xaxis=dict(range=[35, 75], title=\"偏差値\"),\n        yaxis_title=\"\",\n        showlegend=False,\n        height=300,\n    )\n    fig.show()\nelse:\n    print(\"⚠ データ未取得: data_collect.py を実行してください\")\n```\n\n```{python}\n#| label: highschool-table\n\nif hs_file.exists():\n    display(\n        df_hs.sort_values([\"市\", \"偏差値\"], ascending=[True, False])\n        .style.hide(axis=\"index\")\n        .background_gradient(subset=[\"偏差値\"], cmap=\"Blues\")\n    )\n```\n\n*出典: みんなの高校情報 / 高校受験ナビ（2024年度参照値）。偏差値は年度により変動します。*\n\n::: {.callout-note}\n**加古川東高校（偏差値68）** は兵庫県の公立高校でも上位圏に位置し、進学実績が高い。子どもの進学を重視する場合、加古川市は有力な選択肢となる。\n:::\n\n### 子育て支援・行政サービス {#sec-childcare}\n\n各市の子育て支援施策を比較する。医療費助成・保育料補助・支援センター数など、出産後の家計と生活に直結する指標を評価する。\n\n```{python}\n#| label: childcare-table\n\ncc_file = DATA_DIR / \"childcare_support.csv\"\nif cc_file.exists():\n    df_cc = pd.read_csv(cc_file, encoding=\"utf-8-sig\")\n    display(\n        df_cc[[\"市\", \"子ども医療費助成年齢上限\", \"子ども医療費所得制限\",\n               \"子育て支援センター数\", \"第2子以降保育料無償化\", \"病児保育対応施設数\"]]\n        .style.hide(axis=\"index\")\n    )\nelse:\n    print(\"⚠ データ未取得: data_collect.py を実行してください\")\n```\n\n```{python}\n#| label: childcare-bar\n\nif cc_file.exists():\n    fig = px.bar(\n        df_cc,\n        x=\"市\",\n        y=\"子育て支援センター数\",\n        color=\"市\",\n        color_discrete_map=CITY_COLORS,\n        title=\"子育て支援センター数\",\n        text=\"子育て支援センター数\",\n    )\n    fig.update_traces(textposition=\"outside\")\n    fig.update_layout(showlegend=False, yaxis_title=\"施設数\", height=350)\n    fig.show()\n```\n\n*出典: 各市公式ウェブサイト / こども家庭庁（2024年度）*\n\n::: {.callout-tip}\n**明石市の特記事項**: 2013年度より全国初の「第2子以降の保育料を所得制限なく全額無償化」を実施。子ども医療費助成も所得制限なし（18歳まで）。子育て支援の先進自治体として全国的に注目されており、近年の人口増加を支える主要因のひとつ。\n:::\n\n### 医療環境 {#sec-medical}\n\n出産・育児期に直結する産婦人科・小児科の充実度を比較する。NICU（新生児集中治療室）保有や夜間救急小児対応は、出産後の安心感に大きく関わる。\n\n```{python}\n#| label: medical-table\n\nmed_file = DATA_DIR / \"medical.csv\"\nif med_file.exists():\n    df_med = pd.read_csv(med_file, encoding=\"utf-8-sig\")\n    display(\n        df_med[[\"市\", \"産婦人科・産科施設数\", \"小児科施設数\",\n                \"総合病院数（200床以上）\", \"NICU保有\", \"夜間救急小児対応\"]]\n        .style.hide(axis=\"index\")\n    )\nelse:\n    print(\"⚠ データ未取得: data_collect.py を実行してください\")\n```\n\n```{python}\n#| label: medical-bar\n\nif med_file.exists():\n    fig = go.Figure()\n    fig.add_trace(go.Bar(\n        name=\"産婦人科・産科\",\n        x=df_med[\"市\"],\n        y=df_med[\"産婦人科・産科施設数\"],\n        marker_color=[CITY_COLORS[c] for c in df_med[\"市\"]],\n        opacity=1.0,\n        text=df_med[\"産婦人科・産科施設数\"],\n        textposition=\"outside\",\n    ))\n    fig.add_trace(go.Bar(\n        name=\"小児科\",\n        x=df_med[\"市\"],\n        y=df_med[\"小児科施設数\"],\n        marker_color=[CITY_COLORS[c] for c in df_med[\"市\"]],\n        opacity=0.5,\n        text=df_med[\"小児科施設数\"],\n        textposition=\"outside\",\n    ))\n    fig.update_layout(\n        barmode=\"group\",\n        title=\"医療機関数比較（産婦人科・小児科）\",\n        yaxis_title=\"施設数\",\n        height=380,\n    )\n    fig.show()\n```\n\n*出典: 厚生労働省「医療機能情報提供制度（ナビイ）」/ 各病院公式HP（2024年度）*\n\n::: {.callout-warning}\n**高砂市の注意点**: 市内の産婦人科施設は2か所と少なく、出産・緊急時は加古川市・姫路市の医療機関に依存するケースがある。NICU保有病院も市内にないため、ハイリスク出産に備えた分娩先の事前確認を推奨する。\n:::\n\n### 住宅価格 {#sec-price}\n\n不動産情報ライブラリ（国土交通省）の成約・取引価格データに基づく。戸建て・マンション別の価格分布と築年数の内訳を確認する。\n\n```{python}\n#| label: price-plot-by-type\n\nprice_file = DATA_DIR / \"housing_prices.csv\"\nif price_file.exists():\n    df_price = pd.read_csv(price_file, encoding=\"utf-8-sig\")\n\n    # 種別×市の箱ひげ図\n    fig = px.box(\n        df_price,\n        x=\"市\",\n        y=\"取引価格（万円）\",\n        color=\"種別\",\n        title=\"中古住宅 取引価格分布（種別別）\",\n        labels={\"取引価格（万円）\": \"取引価格（万円）\", \"市\": \"\"},\n        category_orders={\"市\": [\"高砂市\", \"加古川市\", \"明石市\"]},\n    )\n    fig.update_layout(yaxis_range=[0, 8000], legend_title=\"種別\")\n    fig.show()\nelse:\n    print(\"⚠ データ未取得: data_collect.py を実行してください\")\n```\n\n```{python}\n#| label: price-summary-table\n\nif price_file.exists():\n    # 市×種別のクロス集計\n    summary = (\n        df_price.groupby([\"市\", \"種別\"])[\"取引価格（万円）\"]\n        .agg(件数=\"count\", 最安値=\"min\", 中央値=\"median\", 平均=\"mean\", 最高値=\"max\")\n        .round(0)\n        .astype(int)\n    )\n    display(summary)\n```\n\n```{python}\n#| label: price-age-hist\n\nif price_file.exists():\n    import re\n\n    # 建築年から西暦を抽出（和暦・西暦どちらにも対応）\n    def wareki_to_seireki(s):\n        s = str(s)\n        m = re.match(r\"昭和(\\d+)年\", s)\n        if m:\n            return 1925 + int(m.group(1))\n        m = re.match(r\"平成(\\d+)年\", s)\n        if m:\n            return 1988 + int(m.group(1))\n        m = re.match(r\"令和(\\d+)年\", s)\n        if m:\n            return 2018 + int(m.group(1))\n        m = re.match(r\"(\\d{4})年\", s)  # マンションCSVは西暦直接表記\n        if m:\n            return int(m.group(1))\n        return None\n\n    df_price[\"建築西暦\"] = df_price[\"建築年\"].apply(wareki_to_seireki)\n    df_age = df_price.dropna(subset=[\"建築西暦\"]).copy()\n    df_age[\"築年数\"] = 2025 - df_age[\"建築西暦\"].astype(int)\n    df_age = df_age[df_age[\"築年数\"].between(0, 60)]\n\n    fig = px.histogram(\n        df_age,\n        x=\"築年数\",\n        color=\"市\",\n        facet_row=\"種別\",\n        facet_col=\"市\",\n        nbins=20,\n        title=\"築年数分布（種別×市・〜60年）\",\n        labels={\"築年数\": \"築年数（年）\", \"count\": \"件数\"},\n        color_discrete_map=CITY_COLORS,\n        category_orders={\"市\": [\"高砂市\", \"加古川市\", \"明石市\"], \"種別\": [\"戸建て\", \"マンション\"]},\n    )\n    fig.update_layout(height=500, showlegend=False, yaxis_title=\"件数\")\n    fig.for_each_annotation(lambda a: a.update(text=a.text.split(\"=\")[-1]))\n    fig.show()\n```\n\n*出典: 国土交通省「不動産情報ライブラリ」<https://www.reinfolib.mlit.go.jp/>（2024年第4四半期〜2025年第3四半期の成約・取引価格情報）*\n\n#### 現在の売出し価格（SUUMO掲載物件）\n\n国土交通省データは**成約済みの取引価格**であるのに対し、SUUMOの掲載物件は**現在購入可能な物件の売出し価格**を示す。\n両者を比較することで「過去の相場」と「今すぐ買える価格水準」のギャップを把握できる。\n\n```{python}\n#| label: suumo-load\n\nsuumo_file = DATA_DIR / \"suumo_listings.csv\"\nif suumo_file.exists():\n    df_suumo = pd.read_csv(suumo_file, encoding=\"utf-8-sig\")\n    df_suumo[\"データソース\"] = \"売出し価格（SUUMO）\"\n    _suumo_ok = len(df_suumo) > 0\nelse:\n    _suumo_ok = False\n    print(\"⚠ SUUMOデータ未取得: scraping_suumo.py を実行してください\")\n```\n\n```{python}\n#| label: suumo-price-compare\n\nif _suumo_ok:\n    # 国土交通省データに「データソース」列を追加してSUUMOと結合\n    df_mlit = df_price.rename(columns={\"取引価格（万円）\": \"価格（万円）\"}).copy()\n    df_mlit[\"データソース\"] = \"成約価格（国交省）\"\n\n    df_combined = pd.concat([\n        df_mlit[[\"市\", \"種別\", \"価格（万円）\", \"データソース\"]],\n        df_suumo[[\"市\", \"種別\", \"価格（万円）\", \"データソース\"]],\n    ], ignore_index=True)\n    df_combined = df_combined.dropna(subset=[\"価格（万円）\"])\n    df_combined = df_combined[df_combined[\"価格（万円）\"].between(100, 12000)]\n\n    fig = px.box(\n        df_combined,\n        x=\"市\",\n        y=\"価格（万円）\",\n        color=\"データソース\",\n        facet_col=\"種別\",\n        title=\"住宅価格比較：成約価格（国交省）vs 売出し価格（SUUMO）\",\n        labels={\"価格（万円）\": \"価格（万円）\", \"市\": \"\"},\n        category_orders={\n            \"市\": [\"高砂市\", \"加古川市\", \"明石市\"],\n            \"種別\": [\"戸建て\", \"マンション\"],\n        },\n        color_discrete_map={\n            \"成約価格（国交省）\": \"#78909C\",\n            \"売出し価格（SUUMO）\": \"#EF5350\",\n        },\n    )\n    fig.update_layout(height=450, legend_title=\"データソース\")\n    fig.for_each_annotation(lambda a: a.update(text=a.text.split(\"=\")[-1]))\n    fig.show()\n```\n\n```{python}\n#| label: suumo-summary-table\n\nif _suumo_ok:\n    suumo_summary = (\n        df_suumo.dropna(subset=[\"価格（万円）\"])\n        .groupby([\"市\", \"種別\"])[\"価格（万円）\"]\n        .agg(件数=\"count\", 最安値=\"min\", 中央値=\"median\", 平均=\"mean\", 最高値=\"max\")\n        .round(0)\n        .astype(int)\n    )\n    display(suumo_summary)\n```\n\n```{python}\n#| label: suumo-area-scatter\n\nif _suumo_ok:\n    import re as _re\n\n    try:\n        import statsmodels  # noqa: F401\n        _trendline = \"ols\"\n    except ImportError:\n        _trendline = None  # statsmodels 未インストール時はトレンド線なし\n\n    def extract_year(text: str):\n        \"\"\"築年月テキストから西暦を抽出する（例: '1990年3月' → 1990）\"\"\"\n        m = _re.search(r\"(\\d{4})年\", str(text))\n        return int(m.group(1)) if m else None\n\n    df_s = df_suumo.dropna(subset=[\"価格（万円）\"]).copy()\n    df_s[\"築西暦\"] = df_s[\"築年月\"].apply(extract_year)\n    df_s[\"築年数\"] = 2026 - df_s[\"築西暦\"].where(df_s[\"築西暦\"].notna())\n\n    # 戸建て: 建物面積 vs 価格\n    df_ko = df_s[(df_s[\"種別\"] == \"戸建て\") & df_s[\"建物面積（㎡）\"].notna()].copy()\n    # マンション: 専有面積 vs 価格\n    df_ms = df_s[(df_s[\"種別\"] == \"マンション\") & df_s[\"専有面積（㎡）\"].notna()].copy()\n    df_ms[\"建物面積（㎡）\"] = df_ms[\"専有面積（㎡）\"]  # 共通軸として扱う\n\n    df_scatter = pd.concat([\n        df_ko[[\"市\", \"種別\", \"価格（万円）\", \"建物面積（㎡）\", \"築年数\", \"間取り\"]],\n        df_ms[[\"市\", \"種別\", \"価格（万円）\", \"建物面積（㎡）\", \"築年数\", \"間取り\"]],\n    ], ignore_index=True)\n    df_scatter = df_scatter[\n        df_scatter[\"建物面積（㎡）\"].between(10, 300) &\n        df_scatter[\"価格（万円）\"].between(100, 12000)\n    ]\n\n    if len(df_scatter) > 0:\n        fig = px.scatter(\n            df_scatter,\n            x=\"建物面積（㎡）\",\n            y=\"価格（万円）\",\n            color=\"市\",\n            facet_col=\"種別\",\n            hover_data=[\"間取り\", \"築年数\"],\n            trendline=_trendline,\n            title=\"SUUMO掲載物件：面積 vs 価格\" + (\"（回帰直線付き）\" if _trendline else \"\"),\n            labels={\"建物面積（㎡）\": \"面積（㎡）※マンションは専有面積\"},\n            color_discrete_map=CITY_COLORS,\n            category_orders={\"市\": [\"高砂市\", \"加古川市\", \"明石市\"], \"種別\": [\"戸建て\", \"マンション\"]},\n        )\n        fig.update_layout(height=450)\n        fig.for_each_annotation(lambda a: a.update(text=a.text.split(\"=\")[-1]))\n        fig.show()\n    else:\n        print(\"⚠ 散布図を描画するための面積データが不足しています\")\n```\n\n*出典: SUUMO「中古一戸建て・中古マンション」掲載物件（scraping_suumo.py 実行時点の売出し価格。成約を保証するものではない）*\n\n---\n\n## 総合スコアリング {#sec-scoring}\n\n```{python}\n#| label: scoring-calc\n#| include: false\n\n# 住宅価格スコアを実データから計算（中央値が低いほど高スコア）\nprice_scores = {\"高砂市\": 5, \"加古川市\": 4, \"明石市\": 2}  # デフォルト\nif (DATA_DIR / \"housing_prices.csv\").exists():\n    df_p = pd.read_csv(DATA_DIR / \"housing_prices.csv\", encoding=\"utf-8-sig\")\n    medians = df_p.groupby(\"市\")[\"取引価格（万円）\"].median()\n    max_med = medians.max()\n    # 最安値を5点、最高値を1点に線形変換\n    for city in medians.index:\n        price_scores[city] = round(5 - 4 * (medians[city] - medians.min()) / (max_med - medians.min()), 1)\n\n# 犯罪スコアを兵庫県下平均と比較して計算（件数が少ないほど高スコア）\n# 県下平均を3点基準とし、0件→5点、県下平均の2倍→1点で線形スコア化\n# 出典: 兵庫県警察「市区町別刑法犯認知状況（令和6年確定値）」（県下合計: 37,817件 / 533万人 = 71.0件/万人）\nPREF_CRIME_RATE = 71.0  # 兵庫県下 人口1万人あたり認知件数（令和6年確定値）\ncrime_scores = {\"高砂市\": 5, \"加古川市\": 4, \"明石市\": 3}  # デフォルト\nif (DATA_DIR / \"crime_stats.csv\").exists():\n    df_c = pd.read_csv(DATA_DIR / \"crime_stats.csv\", encoding=\"utf-8-sig\")\n    df_c = df_c.set_index(\"市\")\n    rates = df_c[\"人口1万人あたり認知件数\"]\n    for city in rates.index:\n        crime_scores[city] = round(\n            max(1.0, min(5.0, 5 - 4 * rates[city] / (2 * PREF_CRIME_RATE))), 1\n        )\n\n# 子育て支援スコア（childcare_support.csv から取得）\nchildcare_scores = {\"高砂市\": 3, \"加古川市\": 3, \"明石市\": 5}  # デフォルト\nif (DATA_DIR / \"childcare_support.csv\").exists():\n    df_cc_s = pd.read_csv(DATA_DIR / \"childcare_support.csv\", encoding=\"utf-8-sig\").set_index(\"市\")\n    for city in df_cc_s.index:\n        childcare_scores[city] = df_cc_s.loc[city, \"総合スコア（5点満点）\"]\n\n# 医療環境スコア（medical.csv から取得）\nmedical_scores = {\"高砂市\": 2, \"加古川市\": 4, \"明石市\": 5}  # デフォルト\nif (DATA_DIR / \"medical.csv\").exists():\n    df_med_s = pd.read_csv(DATA_DIR / \"medical.csv\", encoding=\"utf-8-sig\").set_index(\"市\")\n    for city in df_med_s.index:\n        medical_scores[city] = df_med_s.loc[city, \"総合スコア（5点満点）\"]\n\n# 評価スコア（5点満点）\n# 教育環境スコア: 保育園（明石が独自施策で優位）と高校（加古川東68が強み）を総合判断\nscores = {\n    \"市\": [\"高砂市\", \"加古川市\", \"明石市\"],\n    \"治安・安全性\": [crime_scores.get(\"高砂市\", 5), crime_scores.get(\"加古川市\", 4), crime_scores.get(\"明石市\", 3)],\n    \"教育環境\":    [2, 4, 4],\n    \"交通アクセス\": [5, 3, 2],\n    \"子育て支援\":  [childcare_scores.get(\"高砂市\", 3), childcare_scores.get(\"加古川市\", 3), childcare_scores.get(\"明石市\", 5)],\n    \"医療環境\":    [medical_scores.get(\"高砂市\", 2), medical_scores.get(\"加古川市\", 4), medical_scores.get(\"明石市\", 5)],\n    \"住宅価格\":    [price_scores.get(\"高砂市\", 5), price_scores.get(\"加古川市\", 4), price_scores.get(\"明石市\", 2)],\n}\ndf_scores = pd.DataFrame(scores)\n\nWEIGHTS = {\n    \"治安・安全性\": 0.20,\n    \"教育環境\":    0.20,\n    \"交通アクセス\": 0.10,\n    \"子育て支援\":  0.15,\n    \"医療環境\":    0.10,\n    \"住宅価格\":    0.25,\n}\naxes = list(WEIGHTS.keys())\n\ndf_scores[\"総合スコア\"] = sum(\n    df_scores[axis] * w for axis, w in WEIGHTS.items()\n)\n```\n\n```{python}\n#| label: radar-chart\n\nfig = go.Figure()\nfor _, row in df_scores.iterrows():\n    vals = [row[ax] for ax in axes] + [row[axes[0]]]\n    fig.add_trace(go.Scatterpolar(\n        r=vals,\n        theta=axes + [axes[0]],\n        fill=\"toself\",\n        name=row[\"市\"],\n        line_color=CITY_COLORS.get(row[\"市\"]),\n    ))\n\nfig.update_layout(\n    polar=dict(\n        radialaxis=dict(visible=True, range=[0, 5]),\n        angularaxis=dict(rotation=45, direction=\"clockwise\"),\n    ),\n    title=\"総合評価レーダーチャート\",\n    showlegend=True,\n    margin=dict(b=60),\n)\nfig.show()\n```\n\n```{python}\n#| label: score-table\n\nresult = (\n    df_scores\n    .set_index(\"市\")[axes + [\"総合スコア\"]]\n    .sort_values(\"総合スコア\", ascending=False)\n    .round(2)\n)\ndisplay(result.style.background_gradient(axis=None, cmap=\"YlGn\", subset=[\"総合スコア\"]))\n```\n\n---\n\n## 結論・推奨 {#sec-conclusion}\n\n```{python}\n#| label: conclusion\n\nbest = df_scores.sort_values(\"総合スコア\", ascending=False).iloc[0]\nsecond = df_scores.sort_values(\"総合スコア\", ascending=False).iloc[1]\nprint(f\"総合スコア1位: {best['市']}（{best['総合スコア']:.2f}点）\")\nprint(f\"総合スコア2位: {second['市']}（{second['総合スコア']:.2f}点）\")\n```\n\n::: {.callout-important}\n**総合推奨先は上記スコアの1位の市です。**\n\nただし、スコアは現時点のデータと重み付けに基づいた参考値です。\n最終判断の前に以下を確認することを強く推奨します：\n\n- **物件ごとのハザードマップ確認**（特に高砂市・加古川市の洪水リスク）\n- **通勤経路の実走・乗車体験**\n- **学区の小中学校の現地見学**\n- **周辺スーパー・医療機関の実地確認**\n:::\n\n---\n\n## データ出典一覧 {#sec-sources}\n\n| データ | 出典 | 取得方法 | 備考 |\n|--------|------|----------|------|\n| 住宅取引価格 | 国土交通省「不動産情報ライブラリ」| ブラウザよりCSVダウンロード | 2024Q4〜2025Q3 |\n| 犯罪統計 | 兵庫県警察「市町別刑法犯認知件数」| 手動入力（要最新確認） | 令和5年（2023年）|\n| 保育所・こども園 | 各市公式ウェブサイト / こども家庭庁 | 手動入力 | 2023年4月時点 |\n| 高校偏差値 | みんなの高校情報 / 高校受験ナビ | 手動入力 | 2024年度参照値 |\n| 自然災害リスク | 国土交通省「ハザードマップポータルサイト」| 目視確認・手動整理 | — |\n| 交通アクセス | Googleマップ・各社乗換案内 | 手動調査 | 概算値 |\n","srcMarkdownNoYaml":"\n\n```{python}\n#| label: setup\n#| include: false\n\nimport pandas as pd\nimport plotly.graph_objects as go\nimport plotly.express as px\nfrom pathlib import Path\nfrom IPython.display import display\n\nDATA_DIR = Path(\"data\")\n\nCITY_COLORS = {\n    \"高砂市\":  \"#2196F3\",\n    \"加古川市\": \"#4CAF50\",\n    \"明石市\":  \"#FF9800\",\n}\n```\n\n## エグゼクティブサマリー {#sec-summary}\n\n本レポートは、兵庫県内の3市（高砂市・加古川市・明石市）における中古住宅購入の意思決定を支援するため、複数の評価軸にわたる比較分析を行ったものです。\n\n::: {.callout-note}\n**通勤先**: 神戸製鋼所 高砂製作所（高砂市荒井町新浜2-3-1）\n**取得形態**: 中古住宅購入\n**重視事項**: 治安・安全性（20%）、教育環境（20%）、子育て支援（15%）\n:::\n\n---\n\n## 評価方法・前提条件 {#sec-method}\n\n### 評価フレームワーク\n\n以下の6軸で各市を評価し、重み付きスコア（各軸5点満点）で総合評価を算出する。30代前半・1〜2年以内に出産予定という家族計画を踏まえ、子育て支援・医療環境を新たに追加した。\n\n```{python}\n#| label: weights-table\n\nweights = {\n    \"評価軸\": [\"治安・安全性\", \"教育環境\", \"交通アクセス\", \"子育て支援・行政\", \"医療環境\", \"住宅価格\"],\n    \"重み\": [\"20%\", \"20%\", \"10%\", \"15%\", \"10%\", \"25%\"],\n    \"選定理由\": [\n        \"子どもの安全な育ちに直結\",\n        \"長期的な教育選択肢（保育〜高校）\",\n        \"高砂製作所への通勤効率\",\n        \"保育料・医療費助成など出産後の家計負担（新規）\",\n        \"産婦人科・NICU・小児救急など出産育児の医療アクセス（新規）\",\n        \"中古住宅購入コスト\",\n    ]\n}\npd.DataFrame(weights).style.hide(axis=\"index\")\n```\n\n---\n\n## 各市の概要 {#sec-overview}\n\n| 項目 | 高砂市 | 加古川市 | 明石市 |\n|------|--------|----------|--------|\n| 人口（2024年） | 約8.3万人 | 約25.7万人 | 約29.7万人 |\n| 面積 | 約34 km² | 約138 km² | 約49 km² |\n| 特徴 | 工業都市・職場最寄り | 播磨地域の中心都市 | 子育て支援・神戸隣接 |\n\n---\n\n## 評価軸別分析 {#sec-analysis}\n\n### 交通アクセス {#sec-access}\n\n通勤先（高砂製作所）までのアクセスを評価する。\n\n```{python}\n#| label: commute-table\n\ncommute = {\n    \"市\": [\"高砂市\", \"加古川市\", \"明石市\"],\n    \"車（目安）\": [\"5〜15分\", \"20〜30分\", \"30〜45分\"],\n    \"電車\": [\"山陽荒井駅 / JR宝殿駅\", \"JR加古川駅経由・乗換1回\", \"JR/山陽・乗換1〜2回\"],\n    \"スコア（5点満点）\": [5, 3, 2],\n}\npd.DataFrame(commute).style.hide(axis=\"index\")\n```\n\n*出典: Googleマップ・各社乗換案内（手動調査）*\n\n### 治安・安全性 {#sec-safety}\n\n犯罪統計と自然災害リスクの2軸で評価する。\n\n```{python}\n#| label: safety-table\n\ncrime_file = DATA_DIR / \"crime_stats.csv\"\nif crime_file.exists():\n    df_crime = pd.read_csv(crime_file, encoding=\"utf-8-sig\")\n    display(df_crime[[\"市\", \"年\", \"認知件数（件）\", \"人口1万人あたり認知件数\"]].style.hide(axis=\"index\"))\nelse:\n    print(\"⚠ データ未取得: data_collect.py を実行してください\")\n```\n\n```{python}\n#| label: safety-chart\n\nif crime_file.exists():\n    fig = px.bar(\n        df_crime,\n        x=\"市\",\n        y=\"人口1万人あたり認知件数\",\n        color=\"市\",\n        color_discrete_map={\"高砂市\": \"#1f77b4\", \"加古川市\": \"#ff7f0e\", \"明石市\": \"#2ca02c\"},\n        title=\"人口1万人あたり刑法犯認知件数（令和6年確定値）\",\n        labels={\"人口1万人あたり認知件数\": \"認知件数（件/万人）\"},\n        text_auto=True,\n    )\n    fig.update_layout(showlegend=False, yaxis_title=\"件/万人\")\n    fig.show()\n```\n\n*出典: 兵庫県警察「市区町別刑法犯認知状況（令和6年確定値）」<https://www.police.pref.hyogo.lg.jp/seikatu/gaitou/statis/data/R06.pdf>*\n\n**自然災害リスク（国土交通省ハザードマップより）**\n\n| リスク種別 | 高砂市 | 加古川市 | 明石市 |\n|-----------|--------|----------|--------|\n| 津波・高潮 | 高（沿岸部） | 中（一部沿岸） | 中（一部沿岸） |\n| 洪水（河川） | 高（加古川河口） | 高（加古川沿い） | 低〜中 |\n| 土砂災害 | 低 | 中（北部） | 低 |\n\n*出典: 国土交通省 ハザードマップポータルサイト <https://disaportal.gsi.go.jp/>（各市ハザードマップより整理）*\n\n::: {.callout-warning}\n高砂市・加古川市は**加古川下流域**に位置し、洪水リスクが高い地区があります。\n購入前に物件ごとのハザードマップ確認を推奨します。\n:::\n\n### 保育園・就学前教育 {#sec-nursery}\n\n認可保育所・認定こども園の量と質（保育料・待機児童・病児保育等）を評価する。\n\n```{python}\n#| label: nursery-bar\n\nnursery_file = DATA_DIR / \"nursery.csv\"\nif nursery_file.exists():\n    df_nur = pd.read_csv(nursery_file, encoding=\"utf-8-sig\")\n\n    fig = go.Figure()\n    fig.add_trace(go.Bar(\n        name=\"認可保育所\",\n        x=df_nur[\"市\"],\n        y=df_nur[\"認可保育所数\"],\n        marker_color=[CITY_COLORS[c] for c in df_nur[\"市\"]],\n        opacity=0.9,\n    ))\n    fig.add_trace(go.Bar(\n        name=\"認定こども園\",\n        x=df_nur[\"市\"],\n        y=df_nur[\"認定こども園数\"],\n        marker_color=[CITY_COLORS[c] for c in df_nur[\"市\"]],\n        opacity=0.5,\n    ))\n    fig.update_layout(\n        barmode=\"stack\",\n        title=\"就学前教育施設数（認可保育所＋認定こども園）\",\n        yaxis_title=\"施設数（園）\",\n        xaxis_title=\"\",\n        legend=dict(orientation=\"v\", x=0.98, y=0.98, xanchor=\"right\", yanchor=\"top\"),\n    )\n    fig.show()\nelse:\n    print(\"⚠ データ未取得: data_collect.py を実行してください\")\n```\n\n```{python}\n#| label: nursery-table\n\nif nursery_file.exists():\n    display_cols = [\"市\", \"待機児童数（人）\", \"保育料月額目安（万円）\", \"第2子以降無償化\", \"病児保育対応施設数\"]\n    display(df_nur[display_cols].style.hide(axis=\"index\"))\n```\n\n*出典: 各市公式ウェブサイト / こども家庭庁「保育所等関連状況取りまとめ」（2023年4月時点）*\n\n::: {.callout-tip}\n**明石市の特記事項**: 全国初の「第2子以降の保育料を所得制限なく全額無償化」を独自施策として実施。保育料の実質負担が大幅に軽減され、近年の人口増加を支える要因のひとつ。\n:::\n\n### 高校進学環境 {#sec-highschool}\n\n市内の公立高校の偏差値分布から、進学環境の質と選択肢の広さを評価する。\n\n```{python}\n#| label: highschool-dot\n\nhs_file = DATA_DIR / \"highschool.csv\"\nif hs_file.exists():\n    df_hs = pd.read_csv(hs_file, encoding=\"utf-8-sig\")\n\n    fig = px.strip(\n        df_hs,\n        x=\"偏差値\",\n        y=\"市\",\n        color=\"市\",\n        hover_data=[\"高校名\", \"偏差値\"],\n        title=\"市内公立高校 偏差値分布\",\n        color_discrete_map=CITY_COLORS,\n        stripmode=\"overlay\",\n    )\n    fig.update_traces(marker_size=14, marker_opacity=0.85)\n    fig.update_layout(\n        xaxis=dict(range=[35, 75], title=\"偏差値\"),\n        yaxis_title=\"\",\n        showlegend=False,\n        height=300,\n    )\n    fig.show()\nelse:\n    print(\"⚠ データ未取得: data_collect.py を実行してください\")\n```\n\n```{python}\n#| label: highschool-table\n\nif hs_file.exists():\n    display(\n        df_hs.sort_values([\"市\", \"偏差値\"], ascending=[True, False])\n        .style.hide(axis=\"index\")\n        .background_gradient(subset=[\"偏差値\"], cmap=\"Blues\")\n    )\n```\n\n*出典: みんなの高校情報 / 高校受験ナビ（2024年度参照値）。偏差値は年度により変動します。*\n\n::: {.callout-note}\n**加古川東高校（偏差値68）** は兵庫県の公立高校でも上位圏に位置し、進学実績が高い。子どもの進学を重視する場合、加古川市は有力な選択肢となる。\n:::\n\n### 子育て支援・行政サービス {#sec-childcare}\n\n各市の子育て支援施策を比較する。医療費助成・保育料補助・支援センター数など、出産後の家計と生活に直結する指標を評価する。\n\n```{python}\n#| label: childcare-table\n\ncc_file = DATA_DIR / \"childcare_support.csv\"\nif cc_file.exists():\n    df_cc = pd.read_csv(cc_file, encoding=\"utf-8-sig\")\n    display(\n        df_cc[[\"市\", \"子ども医療費助成年齢上限\", \"子ども医療費所得制限\",\n               \"子育て支援センター数\", \"第2子以降保育料無償化\", \"病児保育対応施設数\"]]\n        .style.hide(axis=\"index\")\n    )\nelse:\n    print(\"⚠ データ未取得: data_collect.py を実行してください\")\n```\n\n```{python}\n#| label: childcare-bar\n\nif cc_file.exists():\n    fig = px.bar(\n        df_cc,\n        x=\"市\",\n        y=\"子育て支援センター数\",\n        color=\"市\",\n        color_discrete_map=CITY_COLORS,\n        title=\"子育て支援センター数\",\n        text=\"子育て支援センター数\",\n    )\n    fig.update_traces(textposition=\"outside\")\n    fig.update_layout(showlegend=False, yaxis_title=\"施設数\", height=350)\n    fig.show()\n```\n\n*出典: 各市公式ウェブサイト / こども家庭庁（2024年度）*\n\n::: {.callout-tip}\n**明石市の特記事項**: 2013年度より全国初の「第2子以降の保育料を所得制限なく全額無償化」を実施。子ども医療費助成も所得制限なし（18歳まで）。子育て支援の先進自治体として全国的に注目されており、近年の人口増加を支える主要因のひとつ。\n:::\n\n### 医療環境 {#sec-medical}\n\n出産・育児期に直結する産婦人科・小児科の充実度を比較する。NICU（新生児集中治療室）保有や夜間救急小児対応は、出産後の安心感に大きく関わる。\n\n```{python}\n#| label: medical-table\n\nmed_file = DATA_DIR / \"medical.csv\"\nif med_file.exists():\n    df_med = pd.read_csv(med_file, encoding=\"utf-8-sig\")\n    display(\n        df_med[[\"市\", \"産婦人科・産科施設数\", \"小児科施設数\",\n                \"総合病院数（200床以上）\", \"NICU保有\", \"夜間救急小児対応\"]]\n        .style.hide(axis=\"index\")\n    )\nelse:\n    print(\"⚠ データ未取得: data_collect.py を実行してください\")\n```\n\n```{python}\n#| label: medical-bar\n\nif med_file.exists():\n    fig = go.Figure()\n    fig.add_trace(go.Bar(\n        name=\"産婦人科・産科\",\n        x=df_med[\"市\"],\n        y=df_med[\"産婦人科・産科施設数\"],\n        marker_color=[CITY_COLORS[c] for c in df_med[\"市\"]],\n        opacity=1.0,\n        text=df_med[\"産婦人科・産科施設数\"],\n        textposition=\"outside\",\n    ))\n    fig.add_trace(go.Bar(\n        name=\"小児科\",\n        x=df_med[\"市\"],\n        y=df_med[\"小児科施設数\"],\n        marker_color=[CITY_COLORS[c] for c in df_med[\"市\"]],\n        opacity=0.5,\n        text=df_med[\"小児科施設数\"],\n        textposition=\"outside\",\n    ))\n    fig.update_layout(\n        barmode=\"group\",\n        title=\"医療機関数比較（産婦人科・小児科）\",\n        yaxis_title=\"施設数\",\n        height=380,\n    )\n    fig.show()\n```\n\n*出典: 厚生労働省「医療機能情報提供制度（ナビイ）」/ 各病院公式HP（2024年度）*\n\n::: {.callout-warning}\n**高砂市の注意点**: 市内の産婦人科施設は2か所と少なく、出産・緊急時は加古川市・姫路市の医療機関に依存するケースがある。NICU保有病院も市内にないため、ハイリスク出産に備えた分娩先の事前確認を推奨する。\n:::\n\n### 住宅価格 {#sec-price}\n\n不動産情報ライブラリ（国土交通省）の成約・取引価格データに基づく。戸建て・マンション別の価格分布と築年数の内訳を確認する。\n\n```{python}\n#| label: price-plot-by-type\n\nprice_file = DATA_DIR / \"housing_prices.csv\"\nif price_file.exists():\n    df_price = pd.read_csv(price_file, encoding=\"utf-8-sig\")\n\n    # 種別×市の箱ひげ図\n    fig = px.box(\n        df_price,\n        x=\"市\",\n        y=\"取引価格（万円）\",\n        color=\"種別\",\n        title=\"中古住宅 取引価格分布（種別別）\",\n        labels={\"取引価格（万円）\": \"取引価格（万円）\", \"市\": \"\"},\n        category_orders={\"市\": [\"高砂市\", \"加古川市\", \"明石市\"]},\n    )\n    fig.update_layout(yaxis_range=[0, 8000], legend_title=\"種別\")\n    fig.show()\nelse:\n    print(\"⚠ データ未取得: data_collect.py を実行してください\")\n```\n\n```{python}\n#| label: price-summary-table\n\nif price_file.exists():\n    # 市×種別のクロス集計\n    summary = (\n        df_price.groupby([\"市\", \"種別\"])[\"取引価格（万円）\"]\n        .agg(件数=\"count\", 最安値=\"min\", 中央値=\"median\", 平均=\"mean\", 最高値=\"max\")\n        .round(0)\n        .astype(int)\n    )\n    display(summary)\n```\n\n```{python}\n#| label: price-age-hist\n\nif price_file.exists():\n    import re\n\n    # 建築年から西暦を抽出（和暦・西暦どちらにも対応）\n    def wareki_to_seireki(s):\n        s = str(s)\n        m = re.match(r\"昭和(\\d+)年\", s)\n        if m:\n            return 1925 + int(m.group(1))\n        m = re.match(r\"平成(\\d+)年\", s)\n        if m:\n            return 1988 + int(m.group(1))\n        m = re.match(r\"令和(\\d+)年\", s)\n        if m:\n            return 2018 + int(m.group(1))\n        m = re.match(r\"(\\d{4})年\", s)  # マンションCSVは西暦直接表記\n        if m:\n            return int(m.group(1))\n        return None\n\n    df_price[\"建築西暦\"] = df_price[\"建築年\"].apply(wareki_to_seireki)\n    df_age = df_price.dropna(subset=[\"建築西暦\"]).copy()\n    df_age[\"築年数\"] = 2025 - df_age[\"建築西暦\"].astype(int)\n    df_age = df_age[df_age[\"築年数\"].between(0, 60)]\n\n    fig = px.histogram(\n        df_age,\n        x=\"築年数\",\n        color=\"市\",\n        facet_row=\"種別\",\n        facet_col=\"市\",\n        nbins=20,\n        title=\"築年数分布（種別×市・〜60年）\",\n        labels={\"築年数\": \"築年数（年）\", \"count\": \"件数\"},\n        color_discrete_map=CITY_COLORS,\n        category_orders={\"市\": [\"高砂市\", \"加古川市\", \"明石市\"], \"種別\": [\"戸建て\", \"マンション\"]},\n    )\n    fig.update_layout(height=500, showlegend=False, yaxis_title=\"件数\")\n    fig.for_each_annotation(lambda a: a.update(text=a.text.split(\"=\")[-1]))\n    fig.show()\n```\n\n*出典: 国土交通省「不動産情報ライブラリ」<https://www.reinfolib.mlit.go.jp/>（2024年第4四半期〜2025年第3四半期の成約・取引価格情報）*\n\n#### 現在の売出し価格（SUUMO掲載物件）\n\n国土交通省データは**成約済みの取引価格**であるのに対し、SUUMOの掲載物件は**現在購入可能な物件の売出し価格**を示す。\n両者を比較することで「過去の相場」と「今すぐ買える価格水準」のギャップを把握できる。\n\n```{python}\n#| label: suumo-load\n\nsuumo_file = DATA_DIR / \"suumo_listings.csv\"\nif suumo_file.exists():\n    df_suumo = pd.read_csv(suumo_file, encoding=\"utf-8-sig\")\n    df_suumo[\"データソース\"] = \"売出し価格（SUUMO）\"\n    _suumo_ok = len(df_suumo) > 0\nelse:\n    _suumo_ok = False\n    print(\"⚠ SUUMOデータ未取得: scraping_suumo.py を実行してください\")\n```\n\n```{python}\n#| label: suumo-price-compare\n\nif _suumo_ok:\n    # 国土交通省データに「データソース」列を追加してSUUMOと結合\n    df_mlit = df_price.rename(columns={\"取引価格（万円）\": \"価格（万円）\"}).copy()\n    df_mlit[\"データソース\"] = \"成約価格（国交省）\"\n\n    df_combined = pd.concat([\n        df_mlit[[\"市\", \"種別\", \"価格（万円）\", \"データソース\"]],\n        df_suumo[[\"市\", \"種別\", \"価格（万円）\", \"データソース\"]],\n    ], ignore_index=True)\n    df_combined = df_combined.dropna(subset=[\"価格（万円）\"])\n    df_combined = df_combined[df_combined[\"価格（万円）\"].between(100, 12000)]\n\n    fig = px.box(\n        df_combined,\n        x=\"市\",\n        y=\"価格（万円）\",\n        color=\"データソース\",\n        facet_col=\"種別\",\n        title=\"住宅価格比較：成約価格（国交省）vs 売出し価格（SUUMO）\",\n        labels={\"価格（万円）\": \"価格（万円）\", \"市\": \"\"},\n        category_orders={\n            \"市\": [\"高砂市\", \"加古川市\", \"明石市\"],\n            \"種別\": [\"戸建て\", \"マンション\"],\n        },\n        color_discrete_map={\n            \"成約価格（国交省）\": \"#78909C\",\n            \"売出し価格（SUUMO）\": \"#EF5350\",\n        },\n    )\n    fig.update_layout(height=450, legend_title=\"データソース\")\n    fig.for_each_annotation(lambda a: a.update(text=a.text.split(\"=\")[-1]))\n    fig.show()\n```\n\n```{python}\n#| label: suumo-summary-table\n\nif _suumo_ok:\n    suumo_summary = (\n        df_suumo.dropna(subset=[\"価格（万円）\"])\n        .groupby([\"市\", \"種別\"])[\"価格（万円）\"]\n        .agg(件数=\"count\", 最安値=\"min\", 中央値=\"median\", 平均=\"mean\", 最高値=\"max\")\n        .round(0)\n        .astype(int)\n    )\n    display(suumo_summary)\n```\n\n```{python}\n#| label: suumo-area-scatter\n\nif _suumo_ok:\n    import re as _re\n\n    try:\n        import statsmodels  # noqa: F401\n        _trendline = \"ols\"\n    except ImportError:\n        _trendline = None  # statsmodels 未インストール時はトレンド線なし\n\n    def extract_year(text: str):\n        \"\"\"築年月テキストから西暦を抽出する（例: '1990年3月' → 1990）\"\"\"\n        m = _re.search(r\"(\\d{4})年\", str(text))\n        return int(m.group(1)) if m else None\n\n    df_s = df_suumo.dropna(subset=[\"価格（万円）\"]).copy()\n    df_s[\"築西暦\"] = df_s[\"築年月\"].apply(extract_year)\n    df_s[\"築年数\"] = 2026 - df_s[\"築西暦\"].where(df_s[\"築西暦\"].notna())\n\n    # 戸建て: 建物面積 vs 価格\n    df_ko = df_s[(df_s[\"種別\"] == \"戸建て\") & df_s[\"建物面積（㎡）\"].notna()].copy()\n    # マンション: 専有面積 vs 価格\n    df_ms = df_s[(df_s[\"種別\"] == \"マンション\") & df_s[\"専有面積（㎡）\"].notna()].copy()\n    df_ms[\"建物面積（㎡）\"] = df_ms[\"専有面積（㎡）\"]  # 共通軸として扱う\n\n    df_scatter = pd.concat([\n        df_ko[[\"市\", \"種別\", \"価格（万円）\", \"建物面積（㎡）\", \"築年数\", \"間取り\"]],\n        df_ms[[\"市\", \"種別\", \"価格（万円）\", \"建物面積（㎡）\", \"築年数\", \"間取り\"]],\n    ], ignore_index=True)\n    df_scatter = df_scatter[\n        df_scatter[\"建物面積（㎡）\"].between(10, 300) &\n        df_scatter[\"価格（万円）\"].between(100, 12000)\n    ]\n\n    if len(df_scatter) > 0:\n        fig = px.scatter(\n            df_scatter,\n            x=\"建物面積（㎡）\",\n            y=\"価格（万円）\",\n            color=\"市\",\n            facet_col=\"種別\",\n            hover_data=[\"間取り\", \"築年数\"],\n            trendline=_trendline,\n            title=\"SUUMO掲載物件：面積 vs 価格\" + (\"（回帰直線付き）\" if _trendline else \"\"),\n            labels={\"建物面積（㎡）\": \"面積（㎡）※マンションは専有面積\"},\n            color_discrete_map=CITY_COLORS,\n            category_orders={\"市\": [\"高砂市\", \"加古川市\", \"明石市\"], \"種別\": [\"戸建て\", \"マンション\"]},\n        )\n        fig.update_layout(height=450)\n        fig.for_each_annotation(lambda a: a.update(text=a.text.split(\"=\")[-1]))\n        fig.show()\n    else:\n        print(\"⚠ 散布図を描画するための面積データが不足しています\")\n```\n\n*出典: SUUMO「中古一戸建て・中古マンション」掲載物件（scraping_suumo.py 実行時点の売出し価格。成約を保証するものではない）*\n\n---\n\n## 総合スコアリング {#sec-scoring}\n\n```{python}\n#| label: scoring-calc\n#| include: false\n\n# 住宅価格スコアを実データから計算（中央値が低いほど高スコア）\nprice_scores = {\"高砂市\": 5, \"加古川市\": 4, \"明石市\": 2}  # デフォルト\nif (DATA_DIR / \"housing_prices.csv\").exists():\n    df_p = pd.read_csv(DATA_DIR / \"housing_prices.csv\", encoding=\"utf-8-sig\")\n    medians = df_p.groupby(\"市\")[\"取引価格（万円）\"].median()\n    max_med = medians.max()\n    # 最安値を5点、最高値を1点に線形変換\n    for city in medians.index:\n        price_scores[city] = round(5 - 4 * (medians[city] - medians.min()) / (max_med - medians.min()), 1)\n\n# 犯罪スコアを兵庫県下平均と比較して計算（件数が少ないほど高スコア）\n# 県下平均を3点基準とし、0件→5点、県下平均の2倍→1点で線形スコア化\n# 出典: 兵庫県警察「市区町別刑法犯認知状況（令和6年確定値）」（県下合計: 37,817件 / 533万人 = 71.0件/万人）\nPREF_CRIME_RATE = 71.0  # 兵庫県下 人口1万人あたり認知件数（令和6年確定値）\ncrime_scores = {\"高砂市\": 5, \"加古川市\": 4, \"明石市\": 3}  # デフォルト\nif (DATA_DIR / \"crime_stats.csv\").exists():\n    df_c = pd.read_csv(DATA_DIR / \"crime_stats.csv\", encoding=\"utf-8-sig\")\n    df_c = df_c.set_index(\"市\")\n    rates = df_c[\"人口1万人あたり認知件数\"]\n    for city in rates.index:\n        crime_scores[city] = round(\n            max(1.0, min(5.0, 5 - 4 * rates[city] / (2 * PREF_CRIME_RATE))), 1\n        )\n\n# 子育て支援スコア（childcare_support.csv から取得）\nchildcare_scores = {\"高砂市\": 3, \"加古川市\": 3, \"明石市\": 5}  # デフォルト\nif (DATA_DIR / \"childcare_support.csv\").exists():\n    df_cc_s = pd.read_csv(DATA_DIR / \"childcare_support.csv\", encoding=\"utf-8-sig\").set_index(\"市\")\n    for city in df_cc_s.index:\n        childcare_scores[city] = df_cc_s.loc[city, \"総合スコア（5点満点）\"]\n\n# 医療環境スコア（medical.csv から取得）\nmedical_scores = {\"高砂市\": 2, \"加古川市\": 4, \"明石市\": 5}  # デフォルト\nif (DATA_DIR / \"medical.csv\").exists():\n    df_med_s = pd.read_csv(DATA_DIR / \"medical.csv\", encoding=\"utf-8-sig\").set_index(\"市\")\n    for city in df_med_s.index:\n        medical_scores[city] = df_med_s.loc[city, \"総合スコア（5点満点）\"]\n\n# 評価スコア（5点満点）\n# 教育環境スコア: 保育園（明石が独自施策で優位）と高校（加古川東68が強み）を総合判断\nscores = {\n    \"市\": [\"高砂市\", \"加古川市\", \"明石市\"],\n    \"治安・安全性\": [crime_scores.get(\"高砂市\", 5), crime_scores.get(\"加古川市\", 4), crime_scores.get(\"明石市\", 3)],\n    \"教育環境\":    [2, 4, 4],\n    \"交通アクセス\": [5, 3, 2],\n    \"子育て支援\":  [childcare_scores.get(\"高砂市\", 3), childcare_scores.get(\"加古川市\", 3), childcare_scores.get(\"明石市\", 5)],\n    \"医療環境\":    [medical_scores.get(\"高砂市\", 2), medical_scores.get(\"加古川市\", 4), medical_scores.get(\"明石市\", 5)],\n    \"住宅価格\":    [price_scores.get(\"高砂市\", 5), price_scores.get(\"加古川市\", 4), price_scores.get(\"明石市\", 2)],\n}\ndf_scores = pd.DataFrame(scores)\n\nWEIGHTS = {\n    \"治安・安全性\": 0.20,\n    \"教育環境\":    0.20,\n    \"交通アクセス\": 0.10,\n    \"子育て支援\":  0.15,\n    \"医療環境\":    0.10,\n    \"住宅価格\":    0.25,\n}\naxes = list(WEIGHTS.keys())\n\ndf_scores[\"総合スコア\"] = sum(\n    df_scores[axis] * w for axis, w in WEIGHTS.items()\n)\n```\n\n```{python}\n#| label: radar-chart\n\nfig = go.Figure()\nfor _, row in df_scores.iterrows():\n    vals = [row[ax] for ax in axes] + [row[axes[0]]]\n    fig.add_trace(go.Scatterpolar(\n        r=vals,\n        theta=axes + [axes[0]],\n        fill=\"toself\",\n        name=row[\"市\"],\n        line_color=CITY_COLORS.get(row[\"市\"]),\n    ))\n\nfig.update_layout(\n    polar=dict(\n        radialaxis=dict(visible=True, range=[0, 5]),\n        angularaxis=dict(rotation=45, direction=\"clockwise\"),\n    ),\n    title=\"総合評価レーダーチャート\",\n    showlegend=True,\n    margin=dict(b=60),\n)\nfig.show()\n```\n\n```{python}\n#| label: score-table\n\nresult = (\n    df_scores\n    .set_index(\"市\")[axes + [\"総合スコア\"]]\n    .sort_values(\"総合スコア\", ascending=False)\n    .round(2)\n)\ndisplay(result.style.background_gradient(axis=None, cmap=\"YlGn\", subset=[\"総合スコア\"]))\n```\n\n---\n\n## 結論・推奨 {#sec-conclusion}\n\n```{python}\n#| label: conclusion\n\nbest = df_scores.sort_values(\"総合スコア\", ascending=False).iloc[0]\nsecond = df_scores.sort_values(\"総合スコア\", ascending=False).iloc[1]\nprint(f\"総合スコア1位: {best['市']}（{best['総合スコア']:.2f}点）\")\nprint(f\"総合スコア2位: {second['市']}（{second['総合スコア']:.2f}点）\")\n```\n\n::: {.callout-important}\n**総合推奨先は上記スコアの1位の市です。**\n\nただし、スコアは現時点のデータと重み付けに基づいた参考値です。\n最終判断の前に以下を確認することを強く推奨します：\n\n- **物件ごとのハザードマップ確認**（特に高砂市・加古川市の洪水リスク）\n- **通勤経路の実走・乗車体験**\n- **学区の小中学校の現地見学**\n- **周辺スーパー・医療機関の実地確認**\n:::\n\n---\n\n## データ出典一覧 {#sec-sources}\n\n| データ | 出典 | 取得方法 | 備考 |\n|--------|------|----------|------|\n| 住宅取引価格 | 国土交通省「不動産情報ライブラリ」| ブラウザよりCSVダウンロード | 2024Q4〜2025Q3 |\n| 犯罪統計 | 兵庫県警察「市町別刑法犯認知件数」| 手動入力（要最新確認） | 令和5年（2023年）|\n| 保育所・こども園 | 各市公式ウェブサイト / こども家庭庁 | 手動入力 | 2023年4月時点 |\n| 高校偏差値 | みんなの高校情報 / 高校受験ナビ | 手動入力 | 2024年度参照値 |\n| 自然災害リスク | 国土交通省「ハザードマップポータルサイト」| 目視確認・手動整理 | — |\n| 交通アクセス | Googleマップ・各社乗換案内 | 手動調査 | 概算値 |\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"message":false,"engine":"jupyter"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"toc-depth":3,"number-sections":true,"embed-resources":true,"output-file":"index.html"},"language":{"toc-title-document":"目次","toc-title-website":"目次","related-formats-title":"その他のフォーマット","related-notebooks-title":"Notebooks","source-notebooks-prefix":"ソース","other-links-title":"その他のリンク","code-links-title":"コードリンクス","launch-dev-container-title":"Devコンテナを起動する","launch-binder-title":"ランチ Binder","article-notebook-label":"記事ノート","notebook-preview-download":"ノートブックをダウンロード","notebook-preview-download-src":"ソースコードをダウンロードする","notebook-preview-back":"記事に戻る","manuscript-meca-bundle":"MECAアーカイブ","section-title-abstract":"概要","section-title-appendices":"付録","section-title-footnotes":"脚注","section-title-references":"参考文献","section-title-reuse":"ライセンス","section-title-copyright":"著作権","section-title-citation":"引用","appendix-attribution-cite-as":"引用方法","appendix-attribution-bibtex":"BibTeX","appendix-view-license":"ライセンスを表示","title-block-author-single":"作者","title-block-author-plural":"作者","title-block-affiliation-single":"所属","title-block-affiliation-plural":"所属","title-block-published":"公開","title-block-modified":"更新日","title-block-keywords":"キーワード","callout-tip-title":"ヒント","callout-note-title":"ノート","callout-warning-title":"警告","callout-important-title":"重要","callout-caution-title":"注意","code-summary":"コード","code-tools-menu-caption":"コード","code-tools-show-all-code":"すべてのコードを表示","code-tools-hide-all-code":"すべてのコードを非表示","code-tools-view-source":"ソースコードを表示","code-tools-source-code":"ソースコード","tools-share":"Share","tools-download":"Download","code-line":"ライン","code-lines":"ライン","copy-button-tooltip":"コピー","copy-button-tooltip-success":"コピーしました","repo-action-links-edit":"編集","repo-action-links-source":"ソースコード","repo-action-links-issue":"問題を報告","back-to-top":"トップに戻る","search-no-results-text":"一致なし","search-matching-documents-text":"一致した文書","search-copy-link-title":"検索へのリンクをコピー","search-hide-matches-text":"追加の検索結果を非表示","search-more-match-text":"追加の検索結果","search-more-matches-text":"追加の検索結果","search-clear-button-title":"消去","search-text-placeholder":"","search-detached-cancel-button-title":"取消","search-submit-button-title":"検索","search-label":"サーチ","toggle-section":"セクションを切り替え","toggle-sidebar":"サイドバーを切り替える","toggle-dark-mode":"ダークモードの切り替え","toggle-reader-mode":"リーダーモードの切り替え","toggle-navigation":"ナビゲーションを切り替える","crossref-fig-title":"図","crossref-tbl-title":"表","crossref-lst-title":"コード","crossref-thm-title":"定理","crossref-lem-title":"補題","crossref-cor-title":"系","crossref-prp-title":"命題","crossref-cnj-title":"予想","crossref-def-title":"定義","crossref-exm-title":"例","crossref-exr-title":"練習","crossref-ch-prefix":"チャプター","crossref-apx-prefix":"付録","crossref-sec-prefix":"セクション","crossref-eq-prefix":"式","crossref-lof-title":"図一覧","crossref-lot-title":"表一覧","crossref-lol-title":"コード一覧","environment-proof-title":"証明","environment-remark-title":"注釈","environment-solution-title":"解答","listing-page-order-by":"並び替え","listing-page-order-by-default":"デフォルト","listing-page-order-by-date-asc":"日付（昇順）","listing-page-order-by-date-desc":"日付（降順）","listing-page-order-by-number-desc":"ページ番号（降順）","listing-page-order-by-number-asc":"ページ番号（昇順）","listing-page-field-date":"日付","listing-page-field-title":"題名","listing-page-field-description":"説明","listing-page-field-author":"作者","listing-page-field-filename":"ファイル名","listing-page-field-filemodified":"更新日","listing-page-field-subtitle":"副題","listing-page-field-readingtime":"読了目安","listing-page-field-wordcount":"単語数","listing-page-field-categories":"分類","listing-page-minutes-compact":"{0} 分","listing-page-category-all":"すべて","listing-page-no-matches":"一致なし","listing-page-words":"{0}語","listing-page-filter":"フィルター","draft":"下書き"},"metadata":{"lang":"ja","fig-responsive":true,"quarto-version":"1.8.27","jupyter":{"kernelspec":{"name":"python3","language":"python","display_name":"Python 3"}},"theme":"cosmo","toc-title":"目次","code-summary":"コードを表示","title":"住宅選定レポート：高砂市・加古川市・明石市","subtitle":"合理的な住宅選択のための比較分析","author":"","date":"today","date-format":"YYYY年MM月DD日"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}